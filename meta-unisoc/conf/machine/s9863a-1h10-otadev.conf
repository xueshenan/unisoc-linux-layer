#@TYPE: Machine
#@NAME: s9863a-1h10-otadev machine
#@DESCRIPTION: UNISOC s9863a-1h10-otadev machine

require conf/machine/include/s9863a/s9863a.inc
require conf/machine/include/s9863a/trusty.inc
require conf/machine/include/s9863a/video.inc
require conf/machine/include/s9863a/camera.inc
require conf/machine/include/s9863a/gpu.inc

# unisoc common configuration
require conf/machine/include/common/unisoc-common.inc

# use rogue-um or mesa? use rogue-um instead of mesa for EGL & GLES libraries
require conf/machine/include/common/graphic-rogue-um.inc

# support dual-sim
require conf/machine/include/common/dual-sim.inc

# rootfs use ext4 or ubifs ? use ext4
require conf/machine/include/common/ext4-def.inc

AB_PARTITIONS = "true"
#MACHINE_FEATURES = " modem radio engpc usbcontrol powertop rsyslogsetup perflink terminal"

#MACHINE_FEATURES = "charge modem radio engpc usbcontrol powertop rsyslogsetup perflink terminal memion userdata-resize2fs fs_tools android-tools-adbd autoreboot pppd"
MACHINE_FEATURES = "usbcontrol powertop rsyslogsetup perflink terminal memion userdata-resize2fs fs_tools android-tools-adbd autoreboot"

MACHINE_FEATURES += "ota"

SUPPORT_SSHD = "${@bb.utils.contains('USERDEBUG','userdebug','ssh-server-openssh','',d)}"

# For board plugins support
#BOARD_PLUGINS_SUPPORT = "test common wcn-recovery"
DAEMON_INITTAB = "k1:5:respawn:/usr/sbin/ofonod -nd -p uncdev,unisoc,unisocmodem,bluez5,hfp_ag_bluez5,hfp_bluez5,hfpmodem+"
#MACHINE_ADD_DISTRO_FEATURES = "pulseaudio bluetooth"

# MACHINE kernel/bsp/chipram source code configuration file
KERNEL_BOARD = "sp9863a-1h10-otadev"
KERNEL_DT_SUBDIR = "${@bb.utils.contains('DEFAULTTUNE','aarch64','sprd/','',d)}"
UBOOT_BOARD = "sl8581e_1h10_otadev"
SENSOR_BOARD="s9863a1h10"
MACHINE_FEATURES += "sensorhub-cm4"

#KERNEL_DEVICETREE_OVERLAY ?= "sp9863a-1h10-overlay.dtbo"


# current! need define KERNEL_DEFCONFIG
KERNEL_DEFCONFIG = "sprd_s9863a_defconfig"
KERNEL_MACHINE_PATCH = "file://s9863a-1h10-otadev.cfg \
                        ${@bb.utils.contains('PN', 'linux-unisoc-5.4', 'file://0002-s9863a-1h10-otadev-dtbo-in-makefile.patch', '', d)} \
			"

# for recovery kernel image
KERNEL_RECOVERY_DEFCONFIG = "recovery_s9863a_defconfig"
KERNEL_PATCH_FOR_RECOVERY = "file://recovery-s9863a-1h10-otadev.cfg \
                        "

KERNEL_PATCH_FOR_RECOVERY = ""

CHIPRAM_MACHINE_PATCH = ""

U_BOOT_MACHINE_PATCH = ""

SUPPORT_VOICECALL = "true"

# for ofono teleservices dualsim
MULTI_SIM_SET = "-DMULTI_SIM_SUPPORT"

IMAGE_FEATURES_append_pn-unisoc-wayland-image = " prc-localtime"

# if system have symbolic link localtime, enable tele sync time with nitz
TELE_CFLAGS += "${@bb.utils.contains('IMAGE_FEATURES','prc-localtime','-DNITZ_SYNC_TINE_SUPPORT','',d)}"

# Engpc chnl config
#ENGPC_CHNL = "wifionly"
