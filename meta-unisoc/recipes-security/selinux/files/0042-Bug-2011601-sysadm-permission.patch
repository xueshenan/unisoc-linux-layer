From b850fd2475ce6fc730f59d9cac98d33a087b9987 Mon Sep 17 00:00:00 2001
From: "hainan.wang" <hainan.wang@unisoc.com>
Date: Thu, 29 Sep 2022 11:16:03 +0800
Subject: [PATCH] Bug #2011601 sysadm-permission

[root cause  ]: x
[changes     ]:x
[side effects]:x
[self test   ]:x
[download normally]:x
[power on/off normally]:x
[do common repository/branch inspection]:x
[is there dependence]:x
[confirm dependent commit]:x
[board]:x
[test case]:x
[reviewers]:x

commit_template_version:v1
---
 policy/modules/roles/sysadm.if | 26 +++++++++++++++++++++++++-
 policy/modules/roles/sysadm.te |  3 +++
 2 files changed, 28 insertions(+), 1 deletion(-)

diff --git a/policy/modules/roles/sysadm.if b/policy/modules/roles/sysadm.if
index a7afcdd9c..c10f7ebf4 100644
--- a/policy/modules/roles/sysadm.if
+++ b/policy/modules/roles/sysadm.if
@@ -355,7 +355,7 @@ interface(`sysadm_fixed_disk_device_t_blk_file',`
         type fixed_disk_device_t;
     ')
 
-    allow $1 fixed_disk_device_t:blk_file {read write};
+    allow $1 fixed_disk_device_t:blk_file {read write open};
 ')
 
 interface(`sysadm_kmsg_device_t_chr_file',`
@@ -518,3 +518,27 @@ interface(`sysadm_sysadm_t_netlink_generic_socket',`
     allow $1 sysadm_t:netlink_generic_socket {write read create bind};
 ')
 
+interface(`sysadm_unreserved_port_t_tcp_socket',`
+    gen_require(`
+        type unreserved_port_t;
+    ')
+
+    allow $1 unreserved_port_t:tcp_socket {name_bind};
+')
+
+interface(`sysadm_device_t_file',`
+    gen_require(`
+        type device_t;
+    ')
+
+    allow $1 device_t:file {write read open};
+')
+
+interface(`sysadm_unlabeled_t_dir',`
+    gen_require(`
+	    type unlabeled_t;
+    ')
+
+    allow $1 unlabeled_t:dir {mounton};
+')
+
diff --git a/policy/modules/roles/sysadm.te b/policy/modules/roles/sysadm.te
index e0861e1fc..663c48547 100644
--- a/policy/modules/roles/sysadm.te
+++ b/policy/modules/roles/sysadm.te
@@ -1373,4 +1373,7 @@ sysadm_device_t_blk_file(sysadm_t)
 sysadm_sysadm_t_bluetooth_socket(sysadm_t)
 sysadm_dri_device_t_chr_file(sysadm_t)
 sysadm_sysadm_t_netlink_generic_socket(sysadm_t)
+sysadm_unreserved_port_t_tcp_socket(sysadm_t)
+sysadm_device_t_file(sysadm_t)
+sysadm_unlabeled_t_dir(sysadm_t)
 
-- 
2.17.1

